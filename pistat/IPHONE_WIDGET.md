# iPhone Widget for Tank Status

Shows the pumphouse tank status on your iPhone home screen using the free Scriptable app. The widget displays the same BMP image generated by the `/api/epaper.bmp` endpoint — gallons, percent, usage graph, and occupancy info.

## Setup (5 minutes)

### 1. Install Scriptable

Download **Scriptable** from the App Store (free):
https://apps.apple.com/app/scriptable/id1405459188

### 2. Create the Script

1. Open Scriptable
2. Tap **"+"** in the top-right to create a new script
3. Copy the entire contents of [`scriptable-widget.js`](scriptable-widget.js) and paste it in
4. Tap the title bar at the top and rename it to **"Tank Status"** (or whatever you like)
5. Tap **"Done"**

### 3. Test It

Tap the **Play** button in Scriptable to run the script. You should see a preview of the widget with your tank data.

### 4. Add the Widget to Your Home Screen

1. Go to your iPhone home screen
2. **Long-press** on an empty area until apps start jiggling
3. Tap the **"+"** button in the top-left corner
4. Search for **"Scriptable"**
5. Choose the **Medium** size widget and tap **"Add Widget"**
6. **Long-press** the new widget → tap **"Edit Widget"**
7. Under **Script**, select **"Tank Status"** (the script you created)
8. Tap outside the menu to close it

The widget will now show your tank status and refresh approximately every 5 minutes.

## Notes

- **Refresh rate**: The script requests a 5-minute refresh, but iOS throttles widget updates based on battery level, usage patterns, and system load. In practice, expect updates every 5-15 minutes.
- **Network**: The widget fetches the image directly from your pumphouse server. It needs to be reachable from your phone's network (works over your home WiFi or if you have a VPN/port forwarding set up).
- **SSL warning**: The server uses a self-signed certificate. Scriptable handles this without issues.
- **Battery impact**: Minimal — it's just fetching a small BMP image every few minutes.
- **Widget sizes**: The script is set up for a Medium widget. Small will also work but the image will be harder to read.

## Troubleshooting

**Widget shows "Error loading tank status":**
- Check that your phone can reach the server URL
- Try opening `https://REDACTED-HOST:6443/api/epaper.bmp` in Safari
- If Safari shows a certificate warning, accept it — this may help Scriptable connect

**Widget shows old data:**
- iOS throttles widget refreshes — this is normal
- Tap the widget to open Scriptable, then tap Play to force a refresh

**Widget shows "Select Script":**
- Long-press the widget → "Edit Widget" → select your script name

## Sharing with Family

To set up the widget on another iPhone (e.g., your wife's phone):

1. Install Scriptable on their phone
2. Send them the `scriptable-widget.js` file (AirDrop, iMessage, email)
3. They open it in Scriptable and follow steps 2-4 above

Or just have them create a new script in Scriptable and paste the code from this file.
